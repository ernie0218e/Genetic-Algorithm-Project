function fitness = calculateFitness(gene)

% %     rhos_best = [24.5;2.5;-0.142857142857143;0.0857142857142857;-0.0857142857142857];
    
    data_best1 = [0,0,0,0;0.000159035858480688,0.0318058028258629,6.36013547867061e-05,0.0127171257989570;0.000636250961316484,0.0636531280722596,0.000254293532309682,0.0254196562579056;0.00143256004488793,0.0956411433037252,0.000571973537156765,0.0381161104886126;0.00254987403306973,0.127869475487626,0.00101662393963586,0.0508150452699163;0.00399109275813844,0.160438619488433,0.00158831215897759,0.0635250929523893;0.00576012517710519,0.193450115795519,0.00228719233072580,0.0762549816569109;0.00786190240611221,0.227006000495260,0.00311350646855000,0.0890134891062043;0.0103023921727903,0.261209914667973,0.00406758600198257,0.101809552425792;0.0130886123357858,0.296167664244372,0.00514985309271281,0.114652323142444;0.0162286310856766,0.331987221146908,0.00636082065504513,0.127551167342746;0.0197316178893147,0.368778800948588,0.00770109746100738,0.140515686819854;0.0236078371764797,0.406654470872651,0.00917138752330850,0.153555688766331;0.0278686969642114,0.445729284470191,0.0107724956436397,0.166681312235691;0.0325267960608394,0.486121746654413,0.0125053323291718,0.179903084492690;0.0375959243146162,0.527953814591386,0.0143709138225084,0.193231921230058;0.0430911161215644,0.571350916965754,0.0163703685633637,0.206679161569844;0.0490286268709349,0.616441517465367,0.0185049348015628,0.220256537517459;0.0554260322550487,0.663358070054333,0.0207759731787684,0.233976323062418;0.0623022956113908,0.712237407933813,0.0231849749131299,0.247851405648451;0.0696777681853967,0.763220743502918,0.0257335618425629,0.261895286480854;0.0775742382798740,0.816453450124358,0.0284234950814758,0.276122136319537;0.0860148916629630,0.872084505940833,0.0312566706740731,0.290546764726269;0.0950244429535303,0.930266996950387,0.0342351409245363,0.305184810085356;0.104629213225318,0.991158259406729,0.0373611269053277,0.320052835680344;0.114857130194097,1.05491987747499,0.0406370185193750,0.335168330121277;0.125737753160522,1.12171686546714,0.0440653865746531,0.350549791701794;0.137302218735191,1.19171683437645,0.0476489763083103,0.366216702339922;0.149583360513904,1.26508947770778,0.0513907401190463,0.382189772603996;0.162615771838717,1.34200612028513,0.0552938559547411,0.398491070020383;0.176435805726304,1.42263971159330,0.0593617273992642,0.415144019574725;0.191081533170971,1.50716282947517,0.0635980005435457,0.432173511699621;0.206592671527192,1.59574619931830,0.0680065556633250,0.449605898683509;0.223010607579792,1.68855645188506,0.0725915539636388,0.467469264487097;0.240378395617531,1.78575460701484,0.0773574633748216,0.485793569283566;0.258740756840875,1.88749606191473,0.0823090586609732,0.504610649694743;0.278143903849721,1.99392697555463,0.0874514429242631,0.523954284978785;0.298635427142364,2.10518139474566,0.0927900391213156,0.543860248317412;0.320264111050008,2.22137758648547,0.0983306486765439,0.564366415580746;0.343079799965532,2.34261544989490,0.104079483563715,0.585512824741677;0.367133397115859,2.46897650575545,0.110043166401015,0.607341674941936;0.392476503778149,2.60051977566225,0.116228749576432,0.629897138703855;0.419161185329679,2.73727687002766,0.122643709609791,0.653225433641487;0.447239571323282,2.87925096217906,0.129295999524416,0.677374333399613;0.476763574599789,3.02641513140416,0.136194076975368,0.702392894496114;0.507784889963926,3.17871237230586,0.143346904244232,0.728331453336405;0.540354536977091,3.33605574396521,0.150763944025347,0.755240874398364;0.574522415797536,3.49832345454507,0.158455152238726,0.783172310266805;0.610337027763425,3.66536872175481,0.166430984513667,0.812175908605217;0.647845219991442,3.83702385806477,0.174702397149651,0.842300036197267;0.687092185376800,4.01310027070629,0.183280847116337,0.873591278946803];
    data_best2 = [0,0,0,0;-0.000159035858480688,-0.0318058028258629,-6.36013547867061e-05,-0.0127171257989570;-0.000636250961316484,-0.0636531280722596,-0.000254293532309682,-0.0254196562579056;-0.00143256004488793,-0.0956411433037252,-0.000571973537156765,-0.0381161104886126;-0.00254987403306973,-0.127869475487626,-0.00101662393963586,-0.0508150452699163;-0.00399109275813844,-0.160438619488433,-0.00158831215897759,-0.0635250929523893;-0.00576012517710519,-0.193450115795519,-0.00228719233072580,-0.0762549816569109;-0.00786190240611221,-0.227006000495260,-0.00311350646855000,-0.0890134891062043;-0.0103023921727903,-0.261209914667973,-0.00406758600198257,-0.101809552425792;-0.0130886123357858,-0.296167664244372,-0.00514985309271281,-0.114652323142444;-0.0162286310856766,-0.331987221146908,-0.00636082065504513,-0.127551167342746;-0.0197316178893147,-0.368778800948588,-0.00770109746100738,-0.140515686819854;-0.0236078371764797,-0.406654470872651,-0.00917138752330850,-0.153555688766331;-0.0278686969642114,-0.445729284470191,-0.0107724956436397,-0.166681312235691;-0.0325267960608394,-0.486121746654413,-0.0125053323291718,-0.179903084492690;-0.0375959243146162,-0.527953814591386,-0.0143709138225084,-0.193231921230058;-0.0430911161215644,-0.571350916965754,-0.0163703685633637,-0.206679161569844;-0.0490286268709349,-0.616441517465367,-0.0185049348015628,-0.220256537517459;-0.0554260322550487,-0.663358070054333,-0.0207759731787684,-0.233976323062418;-0.0623022956113908,-0.712237407933813,-0.0231849749131299,-0.247851405648451;-0.0696777681853967,-0.763220743502918,-0.0257335618425629,-0.261895286480854;-0.0775742382798740,-0.816453450124358,-0.0284234950814758,-0.276122136319537;-0.0860148916629630,-0.872084505940833,-0.0312566706740731,-0.290546764726269;-0.0950244429535303,-0.930266996950387,-0.0342351409245363,-0.305184810085356;-0.104629213225318,-0.991158259406729,-0.0373611269053277,-0.320052835680344;-0.114857130194097,-1.05491987747499,-0.0406370185193750,-0.335168330121277;-0.125737753160522,-1.12171686546714,-0.0440653865746531,-0.350549791701794;-0.137302218735191,-1.19171683437645,-0.0476489763083103,-0.366216702339922;-0.149583360513904,-1.26508947770778,-0.0513907401190463,-0.382189772603996;-0.162615771838717,-1.34200612028513,-0.0552938559547411,-0.398491070020383;-0.176435805726304,-1.42263971159330,-0.0593617273992642,-0.415144019574725;-0.191081533170971,-1.50716282947517,-0.0635980005435457,-0.432173511699621;-0.206592671527192,-1.59574619931830,-0.0680065556633250,-0.449605898683509;-0.223010607579792,-1.68855645188506,-0.0725915539636388,-0.467469264487097;-0.240378395617531,-1.78575460701484,-0.0773574633748216,-0.485793569283566;-0.258740756840875,-1.88749606191473,-0.0823090586609732,-0.504610649694743;-0.278143903849721,-1.99392697555463,-0.0874514429242631,-0.523954284978785;-0.298635427142364,-2.10518139474566,-0.0927900391213156,-0.543860248317412;-0.320264111050008,-2.22137758648547,-0.0983306486765439,-0.564366415580746;-0.343079799965532,-2.34261544989490,-0.104079483563715,-0.585512824741677;-0.367133397115859,-2.46897650575545,-0.110043166401015,-0.607341674941936;-0.392476503778149,-2.60051977566225,-0.116228749576432,-0.629897138703855;-0.419161185329679,-2.73727687002766,-0.122643709609791,-0.653225433641487;-0.447239571323282,-2.87925096217906,-0.129295999524416,-0.677374333399613;-0.476763574599789,-3.02641513140416,-0.136194076975368,-0.702392894496114;-0.507784889963926,-3.17871237230586,-0.143346904244232,-0.728331453336405;-0.540354536977091,-3.33605574396521,-0.150763944025347,-0.755240874398364;-0.574522415797536,-3.49832345454507,-0.158455152238726,-0.783172310266805;-0.610337027763425,-3.66536872175481,-0.166430984513667,-0.812175908605217;-0.647845219991442,-3.83702385806477,-0.174702397149651,-0.842300036197267;-0.687092185376800,-4.01310027070629,-0.183280847116337,-0.873591278946803];
    
    tspan = 0:0.01:0.5;
    y0 = [0 0 0 0];
    % Change this particular warning into an error
    warnId = 'MATLAB:ode45:IntegrationTolNotMet';
    warnstate = warning('error', warnId);
    try
        F = 1;
        [~,y] = ode45(@(t,y) invPendulum(t,y,F, gene), tspan, y0);
        fitness = -sum(sum((y - data_best1).^2));
        F = -1;
        [~,y] = ode45(@(t,y) invPendulum(t,y,F, gene), tspan, y0);
        fitness = fitness-sum(sum((y - data_best2).^2));
    catch
        fitness = -Inf;
    end
% %     rhos = gene;
% %     options = simset('SrcWorkspace','current');
% %     try
% %         sim('InvPendulum',[],options)
% %         fitness = -sum(sum((simout.Data - data_best).^2));
% %     catch
% %         fitness = -Inf;
% %     end
% %     fitness = -sum((gene - [1;2;5;-20;-0.1]).^2);
end


% function fitness = calculateFitness(gene)
% 
% %     rhos_best = [10 2];
%     
%     data_best1 = [0.523598775598299,0;0.523350451625463,-0.0494961713296657;0.522612260103737,-0.0979698079275893;0.521394535463888,-0.145399553230055;0.519707720558173,-0.191765237629968;0.517562504836241,-0.237047969184703;0.514969952170920,-0.281230139159381;0.511941238661023,-0.324295202047674;0.508487649396751,-0.366227673129752;0.504620578459695,-0.407013128472291;0.500351528922834,-0.446638204928466;0.495692112850536,-0.485090600137956;0.490654051298559,-0.522359072526940;0.485249174314049,-0.558433441308099;0.479489384157370,-0.593304432293588;0.473386789645500,-0.626963662204159;0.466953689722046,-0.659403920225943;0.460202394167357,-0.690618922851042;0.453145221801320,-0.720603310017864;0.445794500483360,-0.749352645111123;0.438162567112439,-0.776863414961838;0.430261767627060,-0.803133029847332;0.422104457005262,-0.828159823491238;0.413702999264621,-0.851943053063491;0.405069742134665,-0.874482864660576;0.396217156053152,-0.895780477744261;0.387157793271361,-0.915838201319498;0.377904123050148,-0.934659245626509;0.368468530123840,-0.952247720241178;0.358863314700237,-0.968608634075058;0.349100692460610,-0.983747895375363;0.339192794559701,-0.997672311724975;0.329151667625723,-1.01038959004244;0.318989273760362,-1.02190833658196;0.308717472948900,-1.03223801904863;0.298348147701596,-1.04138928386140;0.287893151034477,-1.04937389707204;0.277364164360642,-1.05620443383148;0.266772696229460,-1.06189427555879;0.256130082326569,-1.06645760994120;0.245447485473876,-1.06990943093404;0.234735895629559,-1.07226553876082;0.224006129888063,-1.07354253991317;0.213268832480105,-1.07375784715085;0.202534469284124,-1.07292957068271;0.191813424982400,-1.07107687593831;0.181115941706648,-1.06821997671236;0.170452019153102,-1.06437964764618;0.159831413796049,-1.05957721920408;0.149263638887827,-1.05383457767331;0.138757964458829,-1.04717416516407;0.128323417317497,-1.03961897960953;0.117968781050326,-1.03119257476581;0.107702596021863,-1.02191906021199;0.0975331711417066,-1.01182293890180;0.0874686488088713,-1.00092943655659;0.0775169328484924,-0.989264554910121;0.0676856458926751,-0.976854495005219;0.0579821292421586,-0.963725650851339;0.0484134428663167,-0.949904609424580;0.0389863654031565,-0.935418150667676;0.0297073941593201,-0.920293247490003;0.0205827451100832,-0.904557065767573;0.0116183528993558,-0.888236964343037;0.00281989998208825,-0.871360344694878;-0.00580714893394857,-0.853954928131672;-0.0142576268646922,-0.836048796444191;-0.0225266493237584,-0.817669870643743;-0.0306096138108956,-0.798845905208534;-0.0385021998119858,-0.779604488083667;-0.0462003687990437,-0.759973040681145;-0.0537003642302171,-0.739978817879864;-0.0609987115497869,-0.719648908025622;-0.0680922181881669,-0.699010232931112;-0.0749779326285452,-0.678089464548825;-0.0816531361040457,-0.656913255422215;-0.0881154222425312,-0.635508197574951;-0.0943626367109672,-0.613900458433342;-0.100392876222662,-0.592115777109197;-0.106204488537269,-0.570179464399831;-0.111796072460783,-0.548116402788059;-0.117166477845542,-0.525951046442200;-0.122314805590229,-0.503707421216076;-0.127240407639869,-0.481409124649010;-0.131942842272481,-0.459079322190420;-0.136421887359719,-0.436740938057992;-0.140677609731021,-0.414416519214139;-0.144710277798821,-0.392128049459260;-0.148520360322666,-0.369896948059297;-0.152108526409214,-0.347744069745740;-0.155475645512235,-0.325689704715621;-0.158622787432610,-0.303753578631518;-0.161551222318334,-0.281954852621554;-0.164262420664512,-0.260312123279395;-0.166758035900776,-0.238843533757784;-0.169039901718990,-0.217566852865401;-0.171110042065624,-0.196499172618645;-0.172970633883557,-0.175656998432723;-0.174624006629281,-0.155056251334362;-0.176072642272893,-0.134712267961810;-0.177319175298104,-0.114639800564832];
%     
%     tspan = 0:0.01:1;
%     y0 = [pi*30/180 0];
%     % Change this particular warning into an error
%     warnId = 'MATLAB:ode45:IntegrationTolNotMet';
%     warnstate = warning('error', warnId);
%     try
%         [~,y] = ode45(@(t,y) pendulum(t,y, gene), tspan, y0);
%         fitness = -sum(sum((y - data_best1).^2));
%     catch
%         fitness = -Inf;
%     end
% 
% end